<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="initial-scale=1, minimum-scale=1, width=device-width">
    <title>Chicken Engine - Wordle</title>
    <link rel="icon" type="image/x-icon" href="./icon.png">

    <link href="https://fonts.googleapis.com/css2?family=Bitcount+Single:wght@100..900&display=swap" rel="stylesheet">
    <style>
      body
      {
          margin: 0;
          min-height: 100vh;
          display: flex;
          flex-direction: column;
          font-family: "Bitcount Single", system-ui;
          background: linear-gradient(135deg, #e5e7ff, #d4d8ff);
          color: white;
          text-shadow: 1px 1px 2px black;
      }

      h1
      {
        font-size: 2em;
      }

      #game
      {
        display: inline-block;
      }
      
      .row
      {
        margin-bottom: 10px;
      }

      input
      {
        width: 50px;
        height: 50px;
        font-size: 24px;
        text-align: center;
        margin: 5px;
        text-transform: uppercase;
        font-family: "Bitcount Single", system-ui;
        border: 3px solid #beccf5;
        border-radius: 16px;
        transition: background-color 0.5s linear, transform 0.4s linear;
      }

      input.correct
      {
        background-color: green;
        color: #e5e7ff;
        transform: scale(1.1);
      }

      input.present
      {
        background-color: #ffa500;
        color: #ffda95;
        transform: scale(1.1);
      }

      input.absent
      {
        background-color: #e5e7ff;
        color: #b6b7ca;
        transform: scale(1.1);
      }

      #result
      {
        margin-top: 20px;
        font-weight: bold;
      }

      button
      {
        background: #95acec;
        border: 2px solid #beccf5;
        border-radius: 20px;
        padding: 8px 16px;
        color: white;
        font-size: 14px;
        cursor: pointer;
        text-shadow: 1px 1px 2px black;
        font-family: "Bitcount Single", system-ui;
        transition: background 0.3s;
      }

      button:hover
      {
        background: #a2bafc;
      }

      .content-wrapper
      {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        gap: 30px;
        flex-wrap: wrap;
        margin: 40px auto;
        max-width: 1200px;
        padding: 0 20px;
      }

      .wordle
      {
        width: 450px;
        margin: 30px 0px;
        background: #95acec;
        padding: 30px;
        border-radius: 16px;
        border: 3px solid #beccf5;
        flex: 1;
        text-align: center;
      }
    </style>
  </head>

  <body>
    <headerr></headerr>
    <script class="headerr" src="./scripts/header.js"></script>

    <section class="content-wrapper">
      <section class="wordle">
      
      <h1>Wordle</h1>
      <h3>Guess today's 5-letter word</h3>

      <div id="game">
      </div>

      <br>

      <button id="submitBtn">Submit</button>
      <div id="result"></div>
      </section>
    </section>

    <footerr></footerr>
    <script src="./scripts/footer.js"></script>

    <script>
      const WORD_LIST_URL = "./wordlist.txt";
      let wordOfTheDay = "";
      let currentTry = 1;
      const maxTries = 6;
      const wordLength = 5;

      const STORAGE_KEY = "wordle-progress";

      const wordstuff = ["You've already attempted today's word!", "You've already solved today's word!"];

      fetch(WORD_LIST_URL)
      .then(res => res.text())
      .then(text => {
        const words = text.trim().split('\n').map(w => w.trim().toLowerCase());
        const dayIndex = Math.floor(Date.now() / (1000 * 60 * 60 * 24)) % words.length;
        wordOfTheDay = words[dayIndex];

        const savedProgress = JSON.parse(localStorage.getItem(STORAGE_KEY));

        if (savedProgress)
        {
          if (savedProgress.word === wordOfTheDay)
          {
            restoreProgress(savedProgress);

            if (savedProgress.completed)
            {
              disableAll();
              const message = savedProgress.guesses.length >= maxTries &&
                              savedProgress.currentTry > maxTries &&
                              !savedProgress.guesses.some(row => row.every(cell => cell.className === "correct"))
                ? wordstuff[0]
                : wordstuff[1];

              document.getElementById("result").textContent = message;
            }
            else
              localStorage.removeItem(STORAGE_KEY);
          }
        }

        if (!savedProgress || savedProgress.word !== wordOfTheDay)
        {
          const firstRow = gameDiv.children[0];
          firstRow.querySelectorAll("input").forEach(inp => inp.disabled = false);
        }
      })
      .catch(err => {
        const savedProgress = JSON.parse(localStorage.getItem(STORAGE_KEY));

        if (!savedProgress)
        {
          document.getElementById("result").textContent = "Error loading word list.";
          console.error(err);
        }
        else
        {
          const message = savedProgress.guesses.length >= maxTries &&
                          savedProgress.currentTry > maxTries &&
                          !savedProgress.guesses.some(row => row.every(cell => cell.className === "correct"))
            ? wordstuff[0]
            : wordstuff[1];

          document.getElementById("result").textContent = message;
        }
      });

      const gameDiv = document.getElementById("game");
      for (let t = 0; t < maxTries; t++)
      {
        const row = document.createElement("div");
        row.classList.add("row");

        for (let i = 0; i < wordLength; i++)
        {
          const input = document.createElement("input");
          input.type = "text";
          input.maxLength = 1;
          input.disabled = t !== 0;
          input.oninput = e => moveFocus(e, row);
          input.onkeydown = e => handleKeys(e);
          row.appendChild(input);
        }

        gameDiv.appendChild(row);
      }

      function moveFocus(event, row)
      {
        const inputs = row.querySelectorAll("input");
        const idx = Array.from(inputs).indexOf(event.target);

        if (event.target.value && idx < wordLength - 1)
          inputs[idx + 1].focus();
      }

      function handleKeys(event)
      {
        const activeRow = gameDiv.children[currentTry - 1];
        const inputs = activeRow.querySelectorAll("input");
        const idx = Array.from(inputs).indexOf(event.target);

        if (event.key === "Backspace" && !event.target.value && idx > 0)
          inputs[idx - 1].focus();
        
        if (event.key === "Enter")
          checkGuess();
      }

      function checkGuess()
      {
        const row = gameDiv.children[currentTry - 1];
        const inputs = Array.from(row.querySelectorAll("input"));

        const guess = inputs.map(i => i.value.toLowerCase()).join("");

        if (inputs.some(i => i.value === ""))
        {
          document.getElementById("result").textContent = "Please enter all letters.";
          return;
        }

        let correctGuess = true;
        for (let i = 0; i < wordLength; i++)
        {
          inputs[i].className = "";
          if (guess[i] === wordOfTheDay[i])
            inputs[i].classList.add("correct");
          else if (wordOfTheDay.includes(guess[i]))
          {
            inputs[i].classList.add("present");
            correctGuess = false;
          }
          else
          {
            inputs[i].classList.add("absent");
            correctGuess = false;
          }

          inputs[i].disabled = true;
        }

        if (correctGuess)
        {
          document.getElementById("result").textContent = "Correct!";
          saveProgress(currentTry, true);
          disableAll();

          const tomorrow = new Date();
          tomorrow.setDate(tomorrow.getDate() + 1);
          document.cookie = `word=${wordOfTheDay}; expires=${tomorrow.toUTCString()}; path=/`;
          return;
        }

        currentTry++;

        if (currentTry - 1 >= maxTries)
        {
          document.getElementById("result").textContent = "Try Again";
          saveProgress(currentTry, false);
          disableAll();
          return;
        }

        saveProgress(currentTry, false);

        const nextRow = gameDiv.children[currentTry - 1];
        nextRow.querySelectorAll("input").forEach(inp => inp.disabled = false);
        nextRow.querySelector("input").focus();
      }

      function saveProgress(tryNumber, completed)
      {
        const progress = {
          word: wordOfTheDay,
          currentTry: tryNumber,
          completed: completed,
          guesses: []
        };

        for (let t = 0; t < maxTries; t++)
        {
          const row = gameDiv.children[t];
          const inputs = row.querySelectorAll("input");
          const guessRow = [];

          for (const input of inputs)
          {
            guessRow.push({
              letter: input.value,
              className: input.className,
              disabled: input.disabled
            });
          }
          progress.guesses.push(guessRow);
        }

        localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
      }

      function restoreProgress(progress)
      {
        currentTry = progress.currentTry;

        for (let t = 0; t < maxTries; t++)
        {
          const row = gameDiv.children[t];
          const inputs = row.querySelectorAll("input");
          const guessRow = progress.guesses[t];

          for (let i = 0; i < wordLength; i++)
          {
            inputs[i].value = guessRow[i].letter;
            inputs[i].className = guessRow[i].className;
            inputs[i].disabled = guessRow[i].disabled;
          }
        }

        if (!progress.completed)
        {
          const currentRow = gameDiv.children[currentTry - 1];

          currentRow.querySelectorAll("input").forEach(inp => {
            if (!inp.value) inp.disabled = false;
          });

          const firstEmpty = Array.from(currentRow.querySelectorAll("input")).find(i => !i.value);
          if (firstEmpty) firstEmpty.focus();
        }
      }

      function getCookieValue(name)
      {
        const cookie = document.cookie
          .split("; ")
          .find(cookie => cookie.startsWith(name + "="));
        return cookie ? cookie.split("=")[1] : null;
      }

      function disableAll()
      {
        document.querySelectorAll("#game input, #submitBtn").forEach(el => el.disabled = true);
      }

      document.getElementById("submitBtn").addEventListener("click", checkGuess);
    </script>
  </body>
</html>